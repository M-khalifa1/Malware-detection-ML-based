# Shannon-entropy-in-malware-detection-based-on-ML
Some Automated malware analysis depends on Shannon entropy as a feature in the machine learning model to distinguish between malicious files and legitimate files.

Shannon entropy: is a mathematical equation used to measure the randomness of data in the file. Based on the percentage of entropy, we can predict whether the file is malicious or not,

Some malware authors use the following techniques to evade detection using entropy:
1-you can do XOR operation with a single character to part of encrypted malware to reduce the entropy, as demonstrated in the below code.
2-add normal data like strings in the malware to reduce the entropy.
3-encrypt part of the malware, such as 20% of malware.

the references :
1-https://practicalsecurityanalytics.com/file-entropy/
2-https://towardsdatascience.com/the-intuition-behind-shannons-entropy-e74820fe9800

import math
def single_byte_xor(text: bytes, key: int) -> bytes:
    """Given a plain text `text` as bytes and an encryption key `key` as a byte
    in range [0, 256) the function encrypts the text by performing
    XOR of all the bytes and the `key` and returns the resultant.
    """
    return bytes([b ^ key for b in text])
def H(sentence): 
    """
    Equation 3.49 (Shannon's Entropy) is implemented.
    """
    entropy = 0 
    # There are 256 possible ASCII characters
    for character_i in range(256): 
        Px = sentence.count(chr(character_i))/len(sentence) 
        if Px > 0: 
            entropy += - Px * math.log(Px, 2) 
    return entropy

print("before reducing the entropy: ",H("sthisissimpleexamplefordemonstratiogshannonentropy"))
#xor_evation will reduce the entropy by xor with one character ""
xor_evasion=single_byte_xor(b"thisissimpleexamplefordemonstratiogshannonentropy.",67)
print("after reducing the entropy using xor-evasion: ",H(str(xor_evasion[6:10])))
